(this.webpackJsonpfrontend_web=this.webpackJsonpfrontend_web||[]).push([[0],{49:function(e,a,t){e.exports=t(64)},64:function(e,a,t){"use strict";t.r(a);var n=t(0),l=t.n(n),r=t(41),c=t.n(r),o=t(7),m=t(5),i=t(10),s=t(9);function u(){var e=Object(i.a)(["\n  query getUser($id: ID!) {\n    user(id: $id) {\n      id\n      username\n      dateJoined\n      firstName\n      lastName\n      lastLogin\n      email\n      isStaff\n      isSuperuser\n    }\n  }\n"]);return u=function(){return e},e}function d(){var e=Object(i.a)(["\n  mutation registerUser(\n    $id: ID\n    $username: String!\n    $email: String!\n    $firstName: String\n    $lastName: String\n  ) {\n    registerUser(\n      id: $id\n      username: $username\n      email: $email\n      firstName: $firstName\n      lastName: $lastName\n    ) {\n      user {\n        id\n        username\n        dateJoined\n        firstName\n        lastName\n        lastLogin\n        email\n        isStaff\n        isSuperuser\n      }\n    }\n  }\n"]);return d=function(){return e},e}function b(){var e=Object(i.a)(["\n  query getUsers {\n    users {\n      id\n      username\n      dateJoined\n      firstName\n      lastName\n      lastLogin\n      email\n      isStaff\n      isSuperuser\n    }\n  }\n"]);return b=function(){return e},e}function p(){var e=Object(i.a)(["\n  query getMe {\n    me {\n      id\n      username\n      dateJoined\n      firstName\n      lastName\n      lastLogin\n      email\n      isStaff\n      isSuperuser\n    }\n  }\n"]);return p=function(){return e},e}function E(){var e=Object(i.a)(["\n  mutation getToken($username: String!, $password: String!) {\n    tokenAuth(username: $username, password: $password) {\n      token\n    }\n  }\n"]);return E=function(){return e},e}var f=Object(s.b)(E()),g=Object(s.b)(p()),v=Object(s.b)(b()),O=Object(s.b)(d()),h=Object(s.b)(u());var j=function(e){var a=Object(m.b)(g),t=a.loading,n=a.error,r=a.data;return t?l.a.createElement("p",null,"Loading..."):n?l.a.createElement("p",null,"Error :("):(console.log(r),l.a.createElement("div",{className:"user-profile-nav"},l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement("b",null,r.me.username)),l.a.createElement("li",null,l.a.createElement(o.b,{exact:!0,to:"/login"},"Logout")))))},N=t(8);var S=function(){var e=Object(N.g)(),a=Object(m.b)(g),t=a.loading,n=a.error,l=a.data;if(t)return null;if(n){if(n.graphQLErrors.length){var r=n.graphQLErrors[0].message;"Signature has expired"!==r&&"You do not have permission to perform this action"!==r||e.push("/login")}return console.log(n),null}return console.log(l),l};var C=function(){var e=S();return console.log(e),l.a.createElement("header",{className:"navbar container"},l.a.createElement("div",{className:"content"},l.a.createElement("h3",null,"Twiga - CCMS"),l.a.createElement("div",{className:"nav-links"},l.a.createElement("ul",null,l.a.createElement("li",null,l.a.createElement(o.b,{exact:!0,to:"/"},"Home")),l.a.createElement("li",null,l.a.createElement(o.b,{to:"/complaints"},"Complaints")),e&&e.me&&e.me.isSuperuser&&l.a.createElement("li",null,l.a.createElement(o.b,{to:"/users"},"Users"))),l.a.createElement(j,null))))},y=t(4);function k(){var e=Object(i.a)(["\n  query kpi {\n    kpiSummary {\n      name\n      count\n    }\n  }\n"]);return k=function(){return e},e}function w(){var e=Object(i.a)(["\n  query getLocSummary {\n    locationSummary {\n      locName\n      locCount\n    }\n  }\n"]);return w=function(){return e},e}function D(){var e=Object(i.a)(["\n  query statusSummary {\n    statusSummary {\n      name\n      count\n    }\n  }\n"]);return D=function(){return e},e}function $(){var e=Object(i.a)(["\n  query natureSummary {\n    natureSummary {\n      name\n      countAll\n      countDone\n    }\n  }\n"]);return $=function(){return e},e}var x=Object(s.b)($()),I=Object(s.b)(D()),q=Object(s.b)(w()),T=Object(s.b)(k()),A=t(26),P=t.n(A),L=function(e){return isNaN(e)?0:parseFloat(e)},_={fmt:function(e){return Number(e).toFixed(2).toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")},sum:function(e){return e.reduce((function(e,a){return L(e)+L(a)}),0)},dpts:function(e){return(Math.round(100*e)/100).toFixed(2)}},F=function(e){var a=e.graphId,t=e.meta,r=e.title,c=e.extra,o=void 0===c?null:c,m=e.type,i=void 0===m?"bar":m;return Object(n.useEffect)((function(){var e={datasets:t.data,labels:t.labels};console.log(e);var n={plugins:{datalabels:{display:!0}},hover:{mode:"index",intersect:!1},tooltips:{mode:"index",intersect:!1,callbacks:{label:function(e,a){var t=a.datasets[e.datasetIndex],n=t.data[e.index],l=t.label;return"".concat(_.fmt(n)," : ").concat(l)}}},scales:{yAxes:[{ticks:{beginAtZero:t.beginAtZero||!1,callback:function(e){return e.toLocaleString()}}}]}};new P.a(document.getElementById(a),{type:i,data:e,options:n})}),[]),l.a.createElement("div",{className:"graph-container bg-white card ".concat(o||"")},l.a.createElement("h6",{className:"pl-1"},r),l.a.createElement("div",null,l.a.createElement("canvas",{id:a,className:"graph p-1",style:{}})))};t(40);var M=function(e){var a=Object(m.b)(x),t=a.loading,n=a.data;if(t)return null;console.log(n);var r={data:[Object(y.a)(Object(y.a)({},{backgroundColor:"rgba(255, 212, 0, .5)",borderWidth:1}),{},{data:n.natureSummary.map((function(e){return e.countAll})),label:"Total"}),Object(y.a)(Object(y.a)({},{backgroundColor:"#3FF",borderWidth:1}),{},{data:n.natureSummary.map((function(e){return e.countDone})),label:"Completed"})],labels:n.natureSummary.map((function(e){return e.name})),beginAtZero:!0};return l.a.createElement(F,{meta:r,graphId:"test-graph",title:"Complaints By Nature"})},R=t(48),U=t(47),V=t.n(U),Y={randomColor:function(){for(var e="#",a=0;a<6;a++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e},randomColors:function(e){var a=this;return Object(R.a)(Array(e).keys()).map((function(){return a.randomColor()}))},contrastColors:function(e){return e.map((function(e){return V()(e)}))}},B=function(e){var a=e.meta,t=e.graphId,r=e.title,c=e.colors,o=e.onDataClick;return Object(n.useEffect)((function(){var e=c||Y.randomColors(a.data.length),n={legend:{position:"right"},plugins:{datalabels:{formatter:function(e,a){var t=0;return a.chart.data.datasets[0].data.map((function(e){t+=e})),(100*e/t).toFixed(0)+"%"},color:Y.contrastColors(e)}},onClick:function(e,t){if(t&&t.length&&o){var n=a.data.slice(t[0]._index,t[0]._index+1)[0];o(n)}}},l={datasets:[{data:a.data.map((function(e){return e.value})),backgroundColor:e}],labels:a.data.map((function(e){return e.name}))},r=new P.a(document.getElementById(t),{type:"pie",data:l,options:n});console.log(r)}),[]),l.a.createElement("div",{className:"graph-container bg-white card p-2"},l.a.createElement("h6",{className:"pl-1"},r),l.a.createElement("div",null,l.a.createElement("canvas",{id:t,className:"graph p-1",style:{}})))};var Q=function(){S();var e=Object(m.b)(I),a=e.loading,t=e.data,n=e.error;if(a)return null;if(n)return null;console.log(t);var r={data:t.statusSummary.map((function(e){return{name:e.name,value:e.count}}))};return l.a.createElement(B,{meta:r,title:"Complaints Status Summary",graphId:"complaints-status-summary"})};var J=function(){S();var e=Object(m.b)(q),a=e.loading,t=e.data,n=e.error;if(a)return null;if(n)return null;var r={data:t.locationSummary.map((function(e){return{name:e.locName,value:e.locCount}}))};return l.a.createElement(B,{meta:r,title:"Complaints Location Summary",graphId:"complaints-location-summary"})};var z=function(){S();var e=Object(m.b)(T),a=e.loading,t=e.data,n=e.error;if(a)return null;if(n)return null;console.log(t),console.log(t.kpiSummary);var r={data:[Object(y.a)(Object(y.a)({},{backgroundColor:"rgba(255, 212, 0, .5)",borderWidth:1}),{},{data:t.kpiSummary.map((function(e){return e.count})),label:"KPI"})],labels:[{name:"1 week",count:0},{name:"2 weeks",count:0},{name:"3-4 weeks",count:0},{name:"5-6 weeks",count:0},{name:"7-8 weeks",count:0},{name:"Above 8 weeks",count:0}].map((function(e){return e.name})),beginAtZero:!0};return l.a.createElement(F,{meta:r,title:"Complaints KPI",graphId:"complaints-kpi-summary"})};var W=function(){return l.a.createElement("div",{className:"dashboard"},l.a.createElement(Q,null),l.a.createElement(J,null),l.a.createElement(M,null),l.a.createElement(z,null))},Z=t(15),K=t(6);var G=function(e){var a=e.columns,t=e.data,n=e.idCol,r=void 0===n?"id":n;return l.a.createElement("div",{className:"table-container"},l.a.createElement("table",null,l.a.createElement("thead",null,l.a.createElement("tr",null,a.map((function(e){return l.a.createElement("th",{key:e.name},e.label)})))),l.a.createElement("tbody",null,t.map((function(e){return l.a.createElement("tr",{key:e[r]},a.map((function(a){return l.a.createElement("td",{key:a.name,className:a.className},a.render?a.render(e):e[a.name])})))})))))},H=function(e){var a=e.name,t=e.extra,n=e.text;return l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{className:"mat-icon material-icons".concat(t?" "+t:"")},a),n&&l.a.createElement("span",null,n))};function X(){var e=Object(i.a)(["\n  mutation sendFeedback(\n    $attachments: [FileType]\n    $id: ID!\n    $email: String!\n    $remarks: String\n  ) {\n    feedback(\n      attachments: $attachments\n      id: $id\n      email: $email\n      remarks: $remarks\n    ) {\n      complaint {\n        id\n        clientName\n      }\n    }\n  }\n"]);return X=function(){return e},e}function ee(){var e=Object(i.a)(["\n  mutation updateDetails(\n    $id: ID!\n    $rca: String!\n    $actionPlan: String!\n    $results: String!\n    $financialImpact: String!\n    $costCenter: String!\n    $responsiblePerson: String!\n    $attachments: [FileType]\n  ) {\n    updateComplaint(\n      id: $id\n      rca: $rca\n      actionPlan: $actionPlan\n      results: $results\n      financialImpact: $financialImpact\n      costCenter: $costCenter\n      responsiblePerson: $responsiblePerson\n      attachments: $attachments\n    ) {\n      complaint {\n        id\n        details\n      }\n    }\n  }\n"]);return ee=function(){return e},e}function ae(){var e=Object(i.a)(["\n  mutation assignTo($id: ID!, $userId: ID!) {\n    assignComplaint(id: $id, userId: $userId) {\n      complaint {\n        id\n        details\n        assignedTo {\n          id\n          username\n        }\n      }\n    }\n  }\n"]);return ae=function(){return e},e}function te(){var e=Object(i.a)(["\n  mutation createComplaint(\n    $details: String!\n    $clientName: String!\n    $openDate: DateTime!\n    $nature: ID!\n    $location: ID!\n    $attachments: [FileType]\n  ) {\n    registerComplaint(\n      details: $details\n      clientName: $clientName\n      nature: $nature\n      location: $location\n      openDate: $openDate\n      attachments: $attachments\n    ) {\n      complaint {\n        id\n      }\n    }\n  }\n"]);return te=function(){return e},e}function ne(){var e=Object(i.a)(["\n  query getLocations {\n    locations {\n      id\n      name\n    }\n  }\n"]);return ne=function(){return e},e}function le(){var e=Object(i.a)(["\n  query getComplAttachments($complaint_id: ID!) {\n    complaintAttachments(complaintId: $complaint_id) {\n      id\n      file\n    }\n  }\n"]);return le=function(){return e},e}function re(){var e=Object(i.a)(["\n  query getNatures {\n    natures {\n      id\n      name\n    }\n  }\n"]);return re=function(){return e},e}function ce(){var e=Object(i.a)(["\n  query getComplaint($id: ID!) {\n    complaint(id: $id) {\n      id\n      clientName\n      openDate\n      status\n      details\n      rca\n      actionPlan\n      results\n      financialImpact\n      costCenter\n      responsiblePerson\n      dueDate\n      nature {\n        id\n        name\n      }\n      location {\n        id\n        name\n      }\n      assignedTo {\n        id\n        username\n      }\n      assignedAt\n      closedBy {\n        id\n        username\n      }\n      closeDate\n    }\n  }\n"]);return ce=function(){return e},e}function oe(){var e=Object(i.a)(["\n  query fetchComplaints($pageNo: Int, $pageSize: Int) {\n    complaints(pageNo: $pageNo, pageSize: $pageSize) {\n      id\n      clientName\n      location {\n        id\n        name\n      }\n      openDate\n      status\n      details\n      rca\n      actionPlan\n      results\n      financialImpact\n      costCenter\n      responsiblePerson\n      dueDate\n      closeDate\n      assignedTo {\n        id\n        username\n      }\n      nature {\n        id\n        name\n      }\n    }\n  }\n"]);return oe=function(){return e},e}var me=Object(s.b)(oe()),ie=Object(s.b)(ce()),se=Object(s.b)(re()),ue=Object(s.b)(le()),de=Object(s.b)(ne()),be=Object(s.b)(te()),pe=Object(s.b)(ae()),Ee=Object(s.b)(ee()),fe=Object(s.b)(X()),ge=t(16),ve=t(23),Oe=t(24);var he=function(e){var a=e.label,t=e.name,n=e.help,r=e.type,c=void 0===r?"text":r,o=e.cls,m=Object(Oe.a)(e,["label","name","help","type","cls"]);return l.a.createElement("div",{className:"input-wrap ".concat(o||"")},l.a.createElement("label",{htmlFor:t},a),"textarea"===c?l.a.createElement("textarea",Object.assign({name:t,id:t},m)):l.a.createElement("input",Object.assign({type:c,name:t,id:t},m)),n&&l.a.createElement("span",{className:"input-help"},n))};var je=function(e){var a=e.label,t=e.name,n=e.options,r=void 0===n?[]:n,c=Object(Oe.a)(e,["label","name","options"]);return l.a.createElement("div",{className:"input-wrap"},l.a.createElement("label",{htmlFor:t},a),l.a.createElement("select",Object.assign({name:t,id:t},c),l.a.createElement("option",{value:""},"---Select---"),r.map((function(e){return l.a.createElement("option",{key:e.id,value:e.id},e.name)}))))},Ne=function(e,a){for(var t=[],n=e.target.files,l=function(e){var l=new FileReader,r=n[e];l.addEventListener("load",(function(){var e=l.result;t.push({filename:r.name,data:e}),t.length===n.length&&function(e){a(e)}(t)})),l.readAsDataURL(r)},r=0;r<n.length;r++)l(r)};var Se=function(e){Object(ve.a)(e);var a=Object(m.b)(se),t=Object(m.b)(de),r=Object(n.useState)(null),c=Object(K.a)(r,2),i=c[0],s=c[1],u=Object(n.useState)(new Map),d=Object(K.a)(u,2),b=d[0],p=d[1],E=Object(m.a)(be),f=Object(K.a)(E,2),g=f[0],v=f[1].loading,O=a.data?a.data.natures:[],h=t.data?t.data.locations:[],j=Object(n.useState)([]),S=Object(K.a)(j,2),C=S[0],k=S[1];function w(e){var a=e.target,t=a.value,n=a.name;p(Object(y.a)(Object(y.a)({},b),{},Object(ge.a)({},n,t)))}return i?l.a.createElement(N.a,{to:i}):l.a.createElement("div",null,l.a.createElement("div",{className:"toolbar"},l.a.createElement("div",{className:"titlebar"},l.a.createElement(o.b,{to:"/complaints",className:"btn btn-light mr-1"},l.a.createElement(H,{name:"keyboard_arrow_left"})),l.a.createElement("h5",null,"Register New Complaint"))),v&&l.a.createElement("p",null,"Sending ...."),l.a.createElement("form",{className:"form",onSubmit:function(e){e.preventDefault(),g({variables:Object(y.a)(Object(y.a)({},b),{},{attachments:C,openDate:"".concat(b.openDate,"T00:00+00:00")}),refetchQueries:[{query:me}]}).then((function(){return s("/complaints")}),(function(e){return console.log("Error: ",e)}))}},l.a.createElement("div",{className:"form-grid-2"},l.a.createElement("div",null,l.a.createElement(he,{name:"clientName",label:"Client Name",onChange:w,required:!0}),l.a.createElement(je,{name:"location",label:"Location",options:h,onChange:w,required:!0}),l.a.createElement(je,{name:"nature",label:"Nature",options:O,onChange:w,required:!0}),l.a.createElement(he,{name:"openDate",label:"Open Date",type:"date",onChange:w,required:!0,max:(new Date).toISOString().split("T")[0]})),l.a.createElement("div",{className:"register-right"},l.a.createElement(he,{name:"details",label:"Details",type:"textarea",onChange:w,required:!0,maxLength:"300",help:"Max 300 characters",cls:"large"}),l.a.createElement(he,{name:"attachments",type:"file",label:"Attachments",multiple:!0,onChange:function(e){return Ne(e,(function(e){return k(e)}))},required:!0}))),l.a.createElement("div",{className:"form-footer"},l.a.createElement("button",null,"Submit"))))};var Ce=function(e){var a=e.onClose,t=e.title,n=e.children,r=(e.posx,e.posy,Object(Oe.a)(e,["onClose","title","children","posx","posy"]));return l.a.createElement("div",Object.assign({className:"modal display-block"},r),l.a.createElement("div",{className:"modal-main"},l.a.createElement("div",{className:"modal-header"},t?l.a.createElement("h5",{className:"modal-title"},t):l.a.createElement("span",null),l.a.createElement("div",{className:"btn-group"},l.a.createElement("button",{type:"button",className:"btn text-warning m-1",onClick:a},l.a.createElement(H,{name:"close"})))),l.a.createElement("div",{className:"modal-content"},n)))};var ye=function(e){var a=e.complaint,t=e.onComplete,r=Object(m.b)(v),c=Object(n.useState)(new Map),o=Object(K.a)(c,2),i=o[0],s=o[1],u=Object(m.a)(pe),d=Object(K.a)(u,2),b=d[0],p=(d[1].loading,r.data?r.data.users.map((function(e){return Object(y.a)(Object(y.a)({},e),{},{name:e.username})})):[]);return console.log(a),l.a.createElement("div",null,l.a.createElement("h5",null,"Assign Complaint To User"),l.a.createElement("form",{className:"form",onSubmit:function(e){e.preventDefault(),b({variables:Object(y.a)(Object(y.a)({},i),{},{id:a.id}),refetchQueries:[{query:me}]}).then((function(){return t()}),(function(e){return console.log("Error: ",e)}))}},l.a.createElement("div",null,l.a.createElement(je,{name:"userId",label:"Assign To",onChange:function(e){var a=e.target,t=a.value,n=a.name;s(Object(y.a)(Object(y.a)({},i),{},Object(ge.a)({},n,t)))},required:!0,options:p})),l.a.createElement("div",{className:"form-footer"},l.a.createElement("button",null,"Submit"))))};var ke=Object(N.h)((function(e){var a=e.match;S();var t=Object(n.useState)(null),r=Object(K.a)(t,2),c=r[0],i=r[1],s=Object(n.useState)(new Map),u=Object(K.a)(s,2),d=u[0],b=u[1],p=Object(n.useState)([]),E=Object(K.a)(p,2),f=E[0],g=E[1],v=Object(m.b)(ie,{variables:{id:a.params.id}}),O=v.loading,h=v.error,j=v.data,C=Object(m.a)(Ee),k=Object(K.a)(C,1)[0];if(O)return l.a.createElement("p",null,"Loading...");if(h)return l.a.createElement("p",null,"Error :(");var w=j.complaint,D={type:"textarea",onChange:function(e){var a=e.target,t=a.value,n=a.name;b(Object(y.a)(Object(y.a)({},d),{},Object(ge.a)({},n,t)))},required:"required",maxLength:"200",help:"Max 200 characters"};return c?l.a.createElement(N.a,{to:c}):l.a.createElement("div",{className:"form-wrap"},l.a.createElement("div",{className:"toolbar"},l.a.createElement("div",{className:"titlebar"},l.a.createElement(o.b,{to:"/complaints",className:"btn btn-light mr-1"},l.a.createElement(H,{name:"keyboard_arrow_left"})),l.a.createElement("h5",null,"Fill complain analysis/resolution"))),l.a.createElement("form",{className:"form form-flex v-scroll",onSubmit:function(e){e.preventDefault();var a=new Map;Object.keys(w).forEach((function(e){d[e]||(a[e]=w[e])})),k({variables:Object(y.a)(Object(y.a)(Object(y.a)({},d),a),{},{attachments:f,id:w.id}),refetchQueries:[{query:me}]}).then((function(){return i("/complaints")}),(function(e){return console.log("Error: ",e)}))}},l.a.createElement("div",{className:"form-fields"},l.a.createElement("p",null,l.a.createElement("b",null,"Details:")," ",w.details),l.a.createElement(he,Object.assign({name:"actionPlan",label:"Action Plan"},D,{defaultValue:w.actionPlan})),l.a.createElement(he,Object.assign({name:"rca",label:"Root Cause Analysis"},D,{defaultValue:w.rca})),l.a.createElement(he,Object.assign({name:"results",label:"Results"},D,{defaultValue:w.results,maxLength:"500",help:"Max 500 characters",rows:"4"})),l.a.createElement(he,Object.assign({name:"financialImpact",label:"Financial Impact"},D,{defaultValue:w.financialImpact})),l.a.createElement(he,Object.assign({name:"costCenter",label:"Cost Center"},D,{defaultValue:w.costCenter})),l.a.createElement(he,Object.assign({name:"responsiblePerson",label:"Responsible Person"},D,{defaultValue:w.responsiblePerson})),l.a.createElement(he,{name:"attachments",type:"file",label:"Attachments",multiple:!0,onChange:function(e){return Ne(e,(function(e){return g(e)}))},required:!0})),l.a.createElement("div",{className:"form-footer"},l.a.createElement("button",null,"Submit"))))}));var we=function(e){var a=e.pageNo,t=e.onPageChanged,n=e.lastPage;return l.a.createElement("ul",{className:"pagination"},l.a.createElement("li",{className:"btn-wrap"},l.a.createElement("button",{onClick:function(){t&&t(a>1?a-1:1)},disabled:a<=1},l.a.createElement(H,{name:"keyboard_arrow_left"})," Previous")),l.a.createElement("li",null,l.a.createElement("span",null,"Page ",a)),l.a.createElement("li",{className:"btn-wrap"},l.a.createElement("button",{onClick:function(){t&&t(a+1)},disabled:n},"Next ",l.a.createElement(H,{name:"keyboard_arrow_right"}))))};var De=function(e){var a=e.complaint,t=(e.img,Object(m.a)(fe)),r=Object(K.a)(t,2),c=r[0];Object(ve.a)(r[1]);var o=Object(n.useState)(null),i=Object(K.a)(o,2),s=i[0],u=i[1],d=Object(n.useState)(null),b=Object(K.a)(d,2),p=b[0],E=b[1],f=Object(n.useState)(null),g=Object(K.a)(f,2),v=g[0],O=g[1],h=Object(n.useState)([]),j=Object(K.a)(h,2),S=j[0],C=j[1];return s?l.a.createElement(N.a,{to:s}):l.a.createElement("div",null,l.a.createElement("form",{className:"form",onSubmit:function(e){e.preventDefault();var t={id:a.id,attachments:S,email:p,remarks:v};console.log(t),c({variables:t,refetchQueries:[{query:me}]}).then((function(){return u("/complaints")}),(function(e){return console.log("Error: ",e)}))},encType:"multipart/form-data"},l.a.createElement("div",null,l.a.createElement(he,{name:"email",type:"email",label:"Customer Email",onChange:function(e){return E(e.target.value)},required:!0}),l.a.createElement(he,{name:"remarks",type:"textarea",label:"Remarks",onChange:function(e){return O(e.target.value)},required:!0}),l.a.createElement(he,{name:"attachments",type:"file",label:"Attachments",multiple:!0,onChange:function(e){return Ne(e,(function(e){return C(e)}))},required:!0})),l.a.createElement("div",{className:"form-footer"},l.a.createElement("button",{className:"p-1"},"Send Feedback"))))},$e={DEV:{baseUrl:"http://localhost:8000/api",ROOT:"http://localhost:8000"},PROD:{baseUrl:"/api",ROOT:""}},xe=$e.PROD.baseUrl,Ie=$e.PROD.ROOT;var qe=function(e){var a=e.doc;console.log(a);var t=a.file.split("/"),n=t[t.length-1];return l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{className:"text-ellipsis"},n),l.a.createElement("a",{href:"".concat(Ie,"/media/").concat(a.file),className:"borded-link",download:!0},l.a.createElement(H,{name:"arrow_downward"})))};var Te=function(e){var a=e.complaint_id,t=Object(m.b)(ue,{variables:{complaint_id:a}}),n=t.loading,r=t.error,c=t.data;if(n||r)return null;var o=c.complaintAttachments;return l.a.createElement("ul",{className:"attachments mb-1"},l.a.createElement("li",null,l.a.createElement("b",null,"Attachments")),o.length?o.map((function(e){return l.a.createElement("li",{key:e.id},l.a.createElement(qe,{doc:e}))})):l.a.createElement("li",null,"None"))},Ae=t(62),Pe=t(63);var Le=Object(N.h)((function(e){var a=e.match;S();var t=Object(n.useRef)(null),r=Object(n.useState)(null),c=Object(K.a)(r,2),i=c[0],s=c[1],u=Object(n.useState)(null),d=Object(K.a)(u,2),b=d[0],p=d[1],E=Object(m.b)(ie,{variables:{id:a.params.id}}),f=E.loading,g=E.error,v=E.data;if(g&&console.error(g),f)return l.a.createElement("p",null,"Loading...");if(g)return l.a.createElement("p",null,"Error :(");var O,h,j=v.complaint,N=j.id,C=j.clientName,y=j.location,k=j.nature,w=j.openDate,D=j.details,$=j.actionPlan,x=j.closeDate,I=j.costCenter,q=j.financialImpact,T=j.rca,A=j.responsiblePerson,P=j.results,L=j.status,_=j.assignedTo,F=j.assignedAt,M=j.closedBy,R=function(e){return e?(e.indexOf("T")&&(e=e.split("T")[0]),Ae(e).format("DD/MM/YYYY")):null};return l.a.createElement("div",{className:"details"},l.a.createElement("div",{className:"toolbar"},l.a.createElement("div",{className:"titlebar"},l.a.createElement(o.b,{to:"/complaints",className:"btn btn-light mr-1"},l.a.createElement(H,{name:"keyboard_arrow_left"})),l.a.createElement("h5",null,"Complete Complaint Information"))),l.a.createElement("div",{className:"details-grid",ref:t},l.a.createElement("div",{className:"grid-form-details"},l.a.createElement("div",null,l.a.createElement("label",null,"Client Name"),l.a.createElement("p",null,C)),l.a.createElement("div",null,l.a.createElement("label",null,"Location"),l.a.createElement("p",null,y.name)),l.a.createElement("div",null,l.a.createElement("label",null,"Nature"),l.a.createElement("p",null,k.name)),l.a.createElement("div",null,l.a.createElement("label",null,"Open Date"),l.a.createElement("p",null,R(w))),l.a.createElement("div",{className:"span"},l.a.createElement("label",null,"Details"),l.a.createElement("p",null,D)),l.a.createElement("div",{className:"span"},l.a.createElement("label",null,"Details"),l.a.createElement("p",null,D)),l.a.createElement("div",null,l.a.createElement("label",null,"Action Plan"),l.a.createElement("p",null,$)),l.a.createElement("div",null,l.a.createElement("label",null,"Root Cause Analysis"),l.a.createElement("p",null,T)),l.a.createElement("div",{className:"span"},l.a.createElement("label",null,"Results"),l.a.createElement("p",null,P)),l.a.createElement("div",{className:"span"},l.a.createElement("label",null,"Financial Impact"),l.a.createElement("p",null,q)),l.a.createElement("div",null,l.a.createElement("label",null,"Cost Center"),l.a.createElement("p",null,I)),l.a.createElement("div",null,l.a.createElement("label",null,"Responsible Person"),l.a.createElement("p",null,A))),l.a.createElement("div",{className:"sidebar mt-1 bg-light"},l.a.createElement("div",{className:"status"},l.a.createElement("label",null,"Status: ",l.a.createElement("span",null,L))),l.a.createElement("ul",null,w&&l.a.createElement("li",null,l.a.createElement(H,{name:"done"}),"On ",R(w),", Created"),_&&l.a.createElement("li",null,l.a.createElement(H,{name:"done"})," On ",R(F),", Assigned to"," ",_.username),M&&l.a.createElement("li",null,l.a.createElement(H,{name:"done"}),"On ",R(x),", Closed by ",M.username),l.a.createElement("li",{className:"kpi"},"KPI:",l.a.createElement("span",{className:"ml-1"},l.a.createElement("b",null,(O=w,h=x,console.log("Open: ".concat(O),"Close: ".concat(h)),h||(h=Ae().format("YYYY-MM-DD")),O.indexOf("T")&&(O=O.split("T")[0]),h.indexOf("T")&&(h=h.split("T")[0]),console.log("Open: ".concat(O),"Close: ".concat(h)),Ae(h).diff(Ae(O),"day")))," day(s)"))),l.a.createElement(Te,{complaint_id:N}),"COMPLETED"===L&&l.a.createElement("button",{className:"send-feedback btn ripple",onClick:function(e){var a=e.target;console.log(a),Pe(t.current,{scrollY:-window.scrollY}).then((function(e){console.log(e);var a=e.toDataURL("image/png");p(a),s(!0)}))}},l.a.createElement(H,{name:"mail_outline",text:"Send Feedback To Customer"})))),i&&l.a.createElement(Ce,{title:"Feedback To: ".concat(j.clientName),onClose:function(){return s(!1)}},l.a.createElement(De,{complaint:j,img:b,onComplete:function(){return s(!1)}})))}));var _e=function(){var e=Object(n.useState)(1),a=Object(K.a)(e,2),t=a[0],r=a[1],c=Object(n.useRef)(!0);S();var i=Object(m.b)(me,{variables:{pageSize:10,pageNo:t}});Object(n.useEffect)((function(){c?c=!1:(console.log("Page changed",i),i.refetch({variables:{pageSize:10,pageNo:t}}))}),[t]);var s=Object(n.useState)(!1),u=Object(K.a)(s,2),d=u[0],b=u[1],p=Object(n.useState)(null),E=Object(K.a)(p,2),f=E[0],g=E[1];if(i.loading)return l.a.createElement("p",null,"Loading...");if(i.error)return l.a.createElement("p",null,"Error :(");var v=[{name:"id",label:"ID"},{name:"clientName",label:"Client Name"},{name:"location_name",label:"Location"},{name:"openDate",label:"Open Date"},{name:"nature_name",label:"Nature of Complaint"},{name:"status",label:"Status"},{name:"assigned_to",label:"Assigned To",render:function(e){return e.assignedTo?l.a.createElement("span",null,e.assignedTo.username):l.a.createElement("button",{onClick:function(){b(!0),g(e)}},"Assign")}},{name:"details",label:"Details",className:"col-ellipsis"},{name:"updateDetails",label:"",render:function(e){return"ASSIGNED"===e.status?l.a.createElement(o.b,{className:"btn btn-light p-1 d-flex align-left",to:"/complaints/update/".concat(e.id)},l.a.createElement(H,{name:"settings",text:"Complete"})):null}},{name:"viewDetails",render:function(e){return l.a.createElement(o.b,{to:"/complaints/view/".concat(e.id),className:"d-flex"},l.a.createElement(H,{name:"unfold_more"}))}}],O=function(e){var a=Date.parse(e);return new Date(a).toLocaleDateString("en-GB")},h=i.data.complaints.map((function(e){return Object(y.a)(Object(y.a)({},e),{},{nature_name:e.nature.name,location_name:e.location?e.location.name:"",openDate:O(e.openDate)})}));return l.a.createElement(l.a.Fragment,null,l.a.createElement(N.b,{path:"/complaints",exact:!0},l.a.createElement("div",{className:"toolbar"},l.a.createElement("h5",null,"List of complaints"),l.a.createElement(o.b,{className:"d-flex btn has-left-icon",to:"/complaints/new-complaint"},l.a.createElement(H,{name:"add",text:"New Complaint"}))),l.a.createElement(G,{columns:v,data:h}),l.a.createElement(we,{pageNo:t,onPageChanged:function(e){r(e)},lastPage:i.data.complaints.length<10})),l.a.createElement(N.b,{path:"/complaints/new-complaint",exact:!0},l.a.createElement(Se,null)),l.a.createElement(N.b,{path:"/complaints/update/:id",exact:!0},l.a.createElement(ke,null)),l.a.createElement(N.b,{path:"/complaints/view/:id",exact:!0},l.a.createElement(Le,null)),d&&l.a.createElement(Ce,{title:f.clientName,onClose:function(){return b(!1)}},l.a.createElement(ye,{complaint:f,onComplete:function(){return b(!1)}})))};var Fe=function(){var e=Object(n.useState)(null),a=Object(K.a)(e,2),t=a[0],r=a[1],c=Object(n.useState)(new Map),i=Object(K.a)(c,2),s=i[0],u=i[1],d=Object(m.a)(O),b=Object(K.a)(d,2),p=b[0],E=b[1].loading;function f(e){var a=e.target,t=a.value,n=a.name;u(Object(y.a)(Object(y.a)({},s),{},Object(ge.a)({},n,t)))}return t?l.a.createElement(N.a,{to:t}):l.a.createElement("div",null,l.a.createElement("div",{className:"toolbar"},l.a.createElement("div",{className:"titlebar"},l.a.createElement(o.b,{to:"/users",className:"btn btn-light mr-1"},l.a.createElement(H,{name:"keyboard_arrow_left"})),l.a.createElement("h5",null,"Register New User"))),E&&l.a.createElement("p",null,"Sending ...."),l.a.createElement("form",{className:"form form-medium",onSubmit:function(e){e.preventDefault(),p({variables:Object(y.a)({},s),refetchQueries:[{query:v},{query:g}]}).then((function(){return r("/users")}),(function(e){return console.log("Error: ",e)}))}},l.a.createElement("div",null,l.a.createElement(he,{name:"username",label:"Username",onChange:f,required:!0}),l.a.createElement(he,{name:"email",label:"Email Address",onChange:f,type:"email",required:!0}),l.a.createElement(he,{name:"firstName",label:"First Name",onChange:f,required:!0}),l.a.createElement(he,{name:"lastName",label:"Last Name",onChange:f,required:!0})),l.a.createElement("div",{className:"form-footer"},l.a.createElement("button",null,"Submit"))))};var Me=Object(N.h)((function(e){var a=e.match,t=Object(n.useState)(null),r=Object(K.a)(t,2),c=r[0],i=r[1],s=Object(n.useState)(new Map),u=Object(K.a)(s,2),d=u[0],b=u[1],p=Object(m.a)(O),E=Object(K.a)(p,2),f=E[0];Object(ve.a)(E[1]);var j=Object(m.b)(h,{variables:{id:a.params.id}}),S=j.loading,C=j.error,k=j.data;if(S)return l.a.createElement("p",null,"Loading...");if(C)return l.a.createElement("p",null,"Error :(");var w=k.user;function D(e){var a=e.target,t=a.value,n=a.name;b(Object(y.a)(Object(y.a)({},d),{},Object(ge.a)({},n,t)))}return c?l.a.createElement(N.a,{to:c}):l.a.createElement("div",null,l.a.createElement("div",{className:"toolbar"},l.a.createElement("div",{className:"titlebar"},l.a.createElement(o.b,{to:"/users",className:"btn btn-light mr-1"},l.a.createElement(H,{name:"keyboard_arrow_left"})),l.a.createElement("h5",null,"Update User"))),S&&l.a.createElement("p",null,"Sending ...."),l.a.createElement("form",{className:"form form-medium",onSubmit:function(e){e.preventDefault();var a=new Map;Object.keys(w).forEach((function(e){d[e]||(a[e]=w[e])})),f({variables:Object(y.a)(Object(y.a)(Object(y.a)({},d),a),{},{id:w.id}),refetchQueries:[{query:v},{query:g}]}).then((function(){return i("/users")}),(function(e){return console.log("Error: ",e)}))}},l.a.createElement("div",null,l.a.createElement(he,{name:"username",label:"Username",onChange:D,required:!0,defaultValue:w.username,readOnly:!0}),l.a.createElement(he,{name:"email",label:"Email Address",onChange:D,type:"email",required:!0,defaultValue:w.email}),l.a.createElement(he,{name:"firstName",label:"First Name",onChange:D,required:!0,defaultValue:w.firstName}),l.a.createElement(he,{name:"lastName",label:"Last Name",onChange:D,required:!0,defaultValue:w.lastName})),l.a.createElement("div",{className:"form-footer"},l.a.createElement("button",null,"Submit"))))}));var Re=function(e){S();var a=Object(m.b)(v),t=a.loading,n=a.error,r=a.data;if(t)return null;if(n)return l.a.createElement("p",null,"Error (:");var c=[{name:"id",label:"ID"},{name:"username",label:"Client Name"},{name:"email",label:"Email"},{name:"name",label:"Full Name"},{name:"actions",label:"",render:function(e){return l.a.createElement("div",null,l.a.createElement("a",{href:"/users/update/".concat(e.id),className:"d-flex align-left"},l.a.createElement(H,{name:"edit",text:"Edit"})))}}],i=r.users.map((function(e){return Object(y.a)(Object(y.a)({},e),{},{name:e.firstName?"".concat(e.firstName," ").concat(e.lastName):null})}));return l.a.createElement(l.a.Fragment,null,l.a.createElement(N.b,{path:"/users",exact:!0},l.a.createElement("div",{className:"toolbar"},l.a.createElement("h5",null,"List of users"),l.a.createElement(o.b,{className:"d-flex btn btn-light has-left-icon",to:"/users/new-user"},l.a.createElement(H,{name:"add",text:"New User"}))),l.a.createElement(G,{columns:c,data:i})),l.a.createElement(N.b,{path:"/users/new-user",exact:!0},l.a.createElement(Fe,null)),l.a.createElement(N.b,{path:"/users/update/:id",exact:!0},l.a.createElement(Me,null)))},Ue={saveToken:function(e,a){sessionStorage.setItem("AccessToken",e),a(!0)},getToken:function(){return sessionStorage.getItem("AccessToken")},removeToken:function(){return sessionStorage.removeItem("AccessToken")}};var Ve=function(e){var a=Object(n.useState)(new Map),t=Object(K.a)(a,2),r=t[0],c=t[1],o=Object(n.useState)(null),i=Object(K.a)(o,2),s=i[0],u=i[1],d=Object(m.a)(f),b=Object(K.a)(d,2),p=b[0],E=b[1],g=(E.loading,E.client);function v(e){var a=e.target,t=a.value,n=a.name;c(Object(y.a)(Object(y.a)({},r),{},Object(ge.a)({},n,t)))}return s?l.a.createElement(N.a,{to:s}):l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"login-page box-shadow"},l.a.createElement("div",{className:"login-header d-flex mb-1 p-1"},l.a.createElement("h3",null,"Twiga - CCMS"),l.a.createElement("img",{src:"/static/images/complaints_register.png",alt:"Image"})),l.a.createElement("form",{className:"form",onSubmit:function(e){e.preventDefault(),g.clearStore(),p({variables:Object(y.a)({},r)}).then((function(e){if(e.data){var a=e.data.tokenAuth.token;Ue.saveToken(a,(function(){u("/")}))}}),(function(e){return console.log("Error: ",e)}))}},l.a.createElement("div",{className:"mt-1"},l.a.createElement(he,{name:"username",label:"Username",onChange:v,required:!0}),l.a.createElement(he,{name:"password",label:"Password",type:"password",onChange:v,required:!0})),l.a.createElement("div",{className:"form-footer"},l.a.createElement("button",null,l.a.createElement("span",{className:"mr-1"},"Login"),l.a.createElement(H,{name:"login"}))))))},Ye=function(){var e=Ue.getToken();return e?"JWT ".concat(e):""},Be=new s.a({uri:"".concat(xe,"/graphql"),request:function(e){e.setContext({headers:{Authorization:Ye()}})}});var Qe=function(){return l.a.createElement(o.a,null,l.a.createElement(Z.a,{client:Be},l.a.createElement(N.d,null,l.a.createElement(N.b,{path:"/login",exact:!0},l.a.createElement(Ve,null)),l.a.createElement(N.b,{path:"/"},l.a.createElement(C,null),l.a.createElement("section",{className:"page-content container"},l.a.createElement("div",{className:"content"},l.a.createElement(N.d,null,l.a.createElement(N.b,{path:"/",exact:!0},l.a.createElement(W,null)),l.a.createElement(N.b,{path:"/complaints"},l.a.createElement(_e,null)),l.a.createElement(N.b,{path:"/users"},l.a.createElement(Re,null)))))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(l.a.createElement(l.a.StrictMode,null,l.a.createElement(Qe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[49,1,2]]]);
//# sourceMappingURL=main.dd5433dd.chunk.js.map